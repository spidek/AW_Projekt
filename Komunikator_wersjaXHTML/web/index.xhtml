<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core" >
    <f:view>
        <h:head>
            <title>Komunikator internetowy</title>
            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
            <link type="text/css" rel="stylesheet" href="style/style.css" /> 
            <script src="http://code.jquery.com/jquery-latest.js"></script>
            <script>
                var currPos = 0;
                var loadChat = function() {
                    $("#chatForm\\:chatbox").load('chat.html');
                    currPos = $(".chat")[0].scrollHeight;
                    $(".chat").scrollTop(currPos);
                }
                var scrollChat = function() {
                    $("#chatForm\\:chatbox").load('chat.html');
                    $(".chat").scrollTop(currPos);
                }
                var currPos;
                
                $(document).ready(function() {
                    $("#chatForm\\:chatbox").load('chat.html', function(){
                        loadChat();
                    });
                    var refreshId = setInterval(function() {
                        scrollChat();
                    }, 1000);
                    $.ajaxSetup({ cache: false });                    
                    $("#chatForm\\:chatbox").scroll(function() {
                        currPos = $(".chat").scrollTop();
                    });
                });
            </script>
        </h:head>
        <h:body>  
            <h:form id="chatForm">
                <div id="wrapper">
                    <div id="menu">
                        <p class="welcome">Witaj, <b><h:outputText value="#{User.name}" /></b></p> 
                        <p class="logout">
                            <h:outputLink value="#{Chat.doLogout(User)}"> <!--logowanie.xhtml-->
                                <h:outputText value="Wyjście z czatu"/> 
                            </h:outputLink>
                        </p>
                        <div style="clear:both"> </div>
                    </div>      
                  <div id="chatForm:chatbox" class="chat"></div> 
<!--                    <h:inputTextarea id="chatbox" class="chat" readonly="true" />-->
                    <h:selectManyListbox id="userList" class="user">
                        <f:selectItems value="#{Chat.returnUserzy()}" />
                    </h:selectManyListbox>

                <h:inputText id="userMessage" class="uMessage" value="#{Message.message}" required="true"/>
                <h:commandButton id="submitMessage" value="Wyślij" action="#{Chat.addMessage(User.writeMessage(Message, Emoticons))}" />    
                </div>
            </h:form>
        </h:body>
    </f:view>
</html>

